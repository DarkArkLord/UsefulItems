<!DOCTYPE html>
<html>
    <head>
        <title>Note</title>
    </head>
    <body>
        <div id="myId"></div>
    </body>

    <script>
        const NoteTypes = {
            GOOD: {Id: 1, Title: 'Good', Color: '#0F0'},
            NEUTRAL: {Id: 2, Title: 'Good', Color: '#FF0'},
            BAD: {Id: 3, Title: 'Bad', Color: '#F00'},
        }
    </script>

    <script>
        var crude_data = [
            {
                Name: 'object1',
                Notes: [
                    {Score: 1, Task: 'task1', Note: 'note', Type: NoteTypes.GOOD},
                    {Score: 0, Task: 'task2', Note: 'note', Type: NoteTypes.NEUTRAL},
                    {Score: -1, Task: 'task3', Note: 'note', Type: NoteTypes.BAD}
                ]
            },
            {
                Name: 'object2',
                Notes: [
                    {Score: 1, Task: 'task1', Note: 'note', Type: NoteTypes.GOOD},
                    {Score: 0, Task: 'task2', Note: 'note', Type: NoteTypes.NEUTRAL},
                    {Score: -1, Task: 'task3', Note: 'note', Type: NoteTypes.BAD}
                ]
            }
        ]
    </script>

    <script>
        function Counter(init = 0, step = 1) {
                var counter = init;
                this.Current = () => counter;
                this.Next = () => counter += step;
            }
    </script>

    <script>
        function List() {
            var counter = new Counter();
            var content = [];

            this.Add = function(item) {
                var temp = {}
                for(var key in item) {
                    temp[key] = item[key];
                }

                temp.Id = counter.Next();

                content.push(temp);
            }
            this.GetAll = () => content;
        }
    </script>

    <script>
        function NotesList() {
            var list = new List();

            this.Add = list.Add;
            this.GetAll = list.GetAll;
            this.GetScore = () => list.GetAll().reduce(((acc, cur) => acc + cur.Score), 0);
        }
    </script>

    <script>
        function UsersList() {
            var list = new List();

            this.Add = (name) => list.Add({
                Name: name, 
                Notes: new NotesList()
            });
            this.GetAll = list.GetAll;
            this.Last = () => list.GetAll()[list.GetAll().length - 1];
        }
    </script>

    <script>
        var users_list = new UsersList();
        crude_data.forEach(user => {
            users_list.Add(user.Name);
            var notes = users_list.Last().Notes;
            user.Notes.forEach(notes.Add);
        });
    </script>

    <script>
        function Table() {
            var result = document.createElement('table');
            result.setAttribute('border', 1);
            result.setAttribute('width', '100%');

            this.Get = () => result;
            this.Add = function(record, attrs = [], style = []) {
                var line = document.createElement('tr');

                attrs.forEach(attr => {
                    line.setAttribute(attr.Name, attr.Value);
                });

                if(style.length > 0) {
                    var style_string = '';
                    style.forEach(element => {
                        style_string += element.Name + ': ' + element.Value + ';';
                    });
                    line.setAttribute('style', style_string);
                }

                record.forEach(element => {
                    var item =  document.createElement('td');
                    item.setAttribute('align', 'center');
                    item.append(element);
                    line.append(item);
                });

                result.append(line)
            }
        }
    </script>

    <script>
        function NotesTable() {
            var table = new Table();

            this.Add = table.Add;
            this.AddNote = function(record, type) {
                table.Add(record, [], [
                    {Name: 'color', Value: type.Color},
                    {Name: 'background-color', Value: '#555;'},
                ]);
            }
            this.Get = function() {
                var result = document.createElement('div');

                var values = table.Get();
                values.style.display = 'none';
                var visible = false;

                var button = document.createElement('button');
                button.innerHTML = 'Toggle';
                button.onclick = function() 
                {
                    if(visible) {
                        values.style.display = 'none';
                    } else {
                        values.style.display = '';
                    }
                    visible = !visible;
                }

                result.append(button);
                result.append(values);

                return result;
            }
        }
    </script>

    <script>
        var table = new Table();
        table.Add(['Id', 'Name', 'Score', 'Notes'])

        users_list.GetAll().forEach(user => {
            var user_notes = new NotesTable();
            user_notes.Add(['Id', 'Score', 'Task', 'Note']);
            user.Notes.GetAll().forEach(note => {
                user_notes.AddNote([note.Id, note.Score, note.Task, note.Note], note.Type);
            });
            table.Add([user.Id, user.Name, user.Notes.GetScore(), user_notes.Get()]);
        });

        document.getElementById("myId").append(table.Get());
    </script>
</html>